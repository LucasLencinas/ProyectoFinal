<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Carga Inicial</title>
    <script src="jquery-2.1.4.min.js"></script>
    <script src="barrios.js"></script>
      <script src="jquery.sprintf.js"></script>
  </head>
    <body>
      <h1>Carga Inicial</h1>
      <form>
        <input onclick="cargarDatos()" type="button" value="Cargar Datos"></Input>
        <input onclick="vaciarDatastore()" type="button" value="Vaciar Datastore"></Input>
      </form>
      <div id="checkboxes"></div>
    </body>
  <script>

$(document).ready(function(){
  var $button;
  $.each(barrios, function(index, barrio){
    $button = $('<input />',{ id: index,
                              type: 'button', 
                              value: barrio.nombre, 
                              click: function(){cargarBarrio(index);}
                            });
    $("#checkboxes").append($button);
    $button.css('cursor', 'pointer');
    $("#checkboxes").append("<br>");
  });
});

function vaciarDatastore(){
  $.ajax({
    type: "GET",
    contentType: "application/json",
    url: "/rampas/Rampas/admin/deleteAll",
    statusCode: {
      200: function (){
      alert("Success - Se borro todo lo de la base de de datos ");
      }
    },
    error: function(jqXHR, textStatus, errorThrown){
      console.log(JSON.stringify(jqXHR) + ". " + JSON.stringify(textStatus) + ". " +JSON.stringify(errorThrown) );
      alert("Hubo un error en el servidor");
    }
  });
}

  function cargarDatos(){
    cargarBarrio(0);
  }


  function cargarBarrio(posicion){
   if (posicion === barrios.length){
     console.log("Success - Carga inicial Finalizada");
   }else{
     console.log("posicion: " + posicion +". Tamanio del array barrios: " + barrios.length);
     $.ajax({
       type: "POST",
       contentType: "application/json",
       data: JSON.stringify(new Array(barrios[posicion])),//Lo acabo de cargar
       url: "/rampas/Rampas/admin/carga",
       statusCode: {
         200: function (){
         console.log("Success - Carga inicial - Barrio " + barrios[posicion].nombre);
         setTimeout(function(){
           cargarBarrio(posicion + 1 );
         },5000);
         }
       },
       error: function(jqXHR, textStatus, errorThrown){
         console.log(JSON.stringify(jqXHR) + ". " + JSON.stringify(textStatus));
         console.log("Hubo un error en el servidor");
        }
      });
   }
 }
/*
  function cargarBarrio(posicion){
    console.log("posicion: " + posicion +". Tamanio del array barrios: " + barrios.length);
    $.ajax({
      type: "POST",
      contentType: "application/json",
      data: JSON.stringify(new Array(barrios[posicion])),//Lo acabo de cargar con el pedido anterior
      url: "/rampas/Rampas/admin/carga",
      statusCode: {
        200: function (){
        alert("Success - Carga inicial - Barrio " + barrios[posicion].nombre);
        $("#"+posicion).prop('disabled', true);
        $("#"+posicion).css('cursor', 'default');
        }
      },
      error: function(jqXHR, textStatus, errorThrown){
        console.log(JSON.stringify(jqXHR) + ". " + JSON.stringify(textStatus) + ". " +JSON.stringify(errorThrown) );
      }
    });
  }
  */
  </script>
</html>