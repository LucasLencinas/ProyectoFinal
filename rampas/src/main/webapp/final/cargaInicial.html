<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Carga Inicial</title>
    <script src="jquery-2.1.4.min.js"></script>
    <script src="barrios.js"></script>
    <script src="usuariosIniciales.js"></script>
    <script src="jquery.sprintf.js"></script>
    <script src="jquery-ui.min.js"></script>
    <link rel="stylesheet" type="text/css" href="jquery-ui.min.css">
  </head>
    <body>
      <h1>Carga Inicial</h1>
      <form>
        <input onclick="cargarDatosRampas()" type="button" value="Cargar Datos"></input>
        <input onclick="cargarDatosUsuarios()" type="button" value="Cargar Usuarios"></input>
        <input onclick="vaciarDatastore()" type="button" value="Vaciar Datastore"></input>
      </form>
      <div id="progressbar"></div>
      <div id="divBorrarBarrios"><h3>Borrar Barrios</h3></div>
      <div id="divAgregarBarrios"><h3>Agregar Barrios</h3></div>

    </body>
  <script>

$(document).ready(function(){

  $( "#progressbar" ).progressbar({
    value: 0.016
  });
  cargarBotonesDeBorradoDeBarrios();
  cargarBotonesDeCargaDeBarrios();
});

function vaciarDatastore(){
  $.ajax({
    type: "GET",
    contentType: "application/json",
    url: "/rampas/Rampas/admin/deleteAll",
    statusCode: {
      200: function (){
      alert("Success - Se borro todo lo de la base de de datos ");
      }
    },
    error: function(jqXHR, textStatus, errorThrown){
      console.log(JSON.stringify(jqXHR) + ". " + JSON.stringify(textStatus) + ". " +JSON.stringify(errorThrown) );
      alert("Hubo un error en el servidor");
    }
  });
}

  function cargarDatosRampas(){
    cargarBarrio(0);
  }

  function cargarBotonesDeBorradoDeBarrios(){
    $.each(barrios, function(index,barrio){
      $("#divBorrarBarrios").append($('<button/>', {
        text: barrio.nombre, //set text 1 to 10
        id: index,
        click: function () {
          console.log("Se hizo click sobre el barrio " + barrio.nombre);
          $.ajax({
             type: "DELETE",
             contentType: "application/json",
             url: "/rampas/Barrios/" + barrio.nombre,
             statusCode: {
               200: function (){
               console.log("Success Borrado - Barrio " + barrio.nombre);
               }
             },
             error: function(jqXHR, textStatus, errorThrown){
              console.log(JSON.stringify(jqXHR) + ". " + JSON.stringify(textStatus));
              console.log("Hubo un error en el servidor");
            }
          });
        }
      }));
    });
  }

  function cargarBotonesDeCargaDeBarrios(){
    $.each(barrios, function(posicion,barrio){
      $("#divAgregarBarrios").append($('<button/>', {
        text: barrio.nombre, //set text 1 to 10
        id: posicion,
        click: function () {
          console.log("Se hizo click sobre el barrio " + barrio.nombre);
          $.ajax({
             type: "POST",
             contentType: "application/json",
             data: JSON.stringify(new Array(barrios[posicion])),//Lo acabo de cargar
             url: "/rampas/Rampas/admin/carga",
             statusCode: {
               200: function (){
               console.log("Success - Carga inicial - Barrio " + barrios[posicion].nombre);
               }
             },
             error: function(jqXHR, textStatus, errorThrown){
               console.log(JSON.stringify(jqXHR) + ". " + JSON.stringify(textStatus));
               console.log("Hubo un error en el servidor");
              }
          });
        }
      }));
    });
  }


  function cargarBarrio(posicion){
   if (posicion === barrios.length){
     console.log("Success - Carga inicial Finalizada");
   }else{
     console.log("posicion: " + posicion +". Tamanio del array barrios: " + barrios.length);
     $.ajax({
       type: "POST",
       contentType: "application/json",
       data: JSON.stringify(new Array(barrios[posicion])),//Lo acabo de cargar
       url: "/rampas/Rampas/admin/carga",
       statusCode: {
         200: function (){
         console.log("Success - Carga inicial - Barrio " + barrios[posicion].nombre);
         $( "#progressbar" ).progressbar( "option", "value", 
            $( "#progressbar" ).progressbar( "option", "value" ) + 2.083 );
         setTimeout(function(){
           cargarBarrio(posicion + 1 );
         },3000);
         }
       },
       error: function(jqXHR, textStatus, errorThrown){
         console.log(JSON.stringify(jqXHR) + ". " + JSON.stringify(textStatus));
         console.log("Hubo un error en el servidor");
        }
      });
   }
 }

function cargarDatosUsuarios(){
  $.ajax({
   type: "POST",
   contentType: "application/json",
   data: JSON.stringify(usuarios),
   url: "/rampas/Usuarios/admin/carga",
   statusCode: {
     200: function (){
     console.log("Success - Carga inicial - Usuario ");
     }
   },
   error: function(jqXHR, textStatus, errorThrown){
     console.log(JSON.stringify(jqXHR) + ". " + JSON.stringify(textStatus));
     console.log("Hubo un error en el servidor");
    }
  });
}
  </script>
</html>